<Window x:Class="Katastata.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:Katastata.Helpers"
        Title="Katastata"
        Width="1100" Height="700"
        MinWidth="700" MinHeight="500"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource WindowBackgroundBrush}" 
        Icon="/Assets/Logo/MainLogo.png"
        WindowStyle="None"   
        ResizeMode="CanResizeWithGrip">

    <Grid>
        <!-- Верхний бар -->
        <Border Background="{DynamicResource AccentBrush}" 
                Height="50" VerticalAlignment="Top"
                MouseLeftButtonDown="TopBar_MouseLeftButtonDown">
            <DockPanel>
                <Image Source="/Assets/Logo/TextLogo.png"
                       Margin="20 10"/>

                <!-- Кнопки управления окном -->
                <StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center"
                                DockPanel.Dock="Right"
                                Margin="0,0,10,0">

                    <Button Content="—"
                            Style="{DynamicResource ThemeSymbolButtonStyle}"
                            Click="Minimize_Click"
                            Cursor="Hand"/>

                    <Button x:Name="FullscreenBtn"
                            Content="🗖"
                            Style="{StaticResource ThemeSymbolButtonStyle}"
                            Click="FullscreenBtn_Click"/>
                    
                    <Button Content="✕"
                            Style="{DynamicResource ThemeSymbolButtonStyle}"
                            Click="Close_Click"
                            Cursor="Hand"/>
                </StackPanel>

                <!-- Кнопки справа -->
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            DockPanel.Dock="Right"
                            Margin="0,0,15,0">
                    
                    <Button x:Name="LogoutBtn"
                            Content="→ Выйти"
                            Style="{DynamicResource ThemeSymbolButtonStyle}"
                            Width="120"
                            ToolTip="Выйти с аккаунта"
                            Margin="0,0,5,0"
                            Click="Logout_Click"/>
                    
                    <Button x:Name="LightThemeBtn"
                            Content="☀"
                            ToolTip="Светлая тема"
                            Style="{DynamicResource ThemeSymbolButtonStyle}"
                            Click="LightTheme_Click"/>
                    
                    <Button x:Name="DarkThemeBtn"
                            Content="🌙"
                            ToolTip="Темная тема"
                            Style="{DynamicResource ThemeSymbolButtonStyle}"
                            Click="DarkTheme_Click"/>
                    
                </StackPanel>
            </DockPanel>
        </Border>

        <!-- Контент -->
        <Grid Margin="20,70,20,20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Панель управления -->
            <StackPanel Orientation="Horizontal"
                        Grid.Row="0"
                        HorizontalAlignment="Left"
                        Margin="0,0,0,15">
                
                <Button Content="⟳ Сканировать"
                        Command="{Binding ScanCommand}"
                        Style="{DynamicResource ThemeButtonStyle}"
                        Click="ScannerBtn_Click"/>
                <TextBlock x:Name="ScanText"
                           Margin="20"
                           FontSize="18"
                           FontWeight="Bold"
                           Foreground="#55aa11"/>

            </StackPanel>

            <StackPanel Orientation="Horizontal"
                        Grid.Row="0"
                        HorizontalAlignment="Right"
                        Margin="0,0,0,20">

                <Button Content="📤 Экспорт"
                        Style="{DynamicResource ThemeButtonStyle}"
                        Click="ExportBtn_Click"
                        Margin="10,0,0,0"/>
                <Button Content="🕓 Сессии"
                        Command="{Binding ShowSessionsCommand}"
                        Style="{DynamicResource ThemeButtonStyle}"
                        Margin="10,0,0,0"/>
                <Button Content="📊 Статистика"
                        Command="{Binding ShowStatisticsCommand}"
                        Style="{DynamicResource ThemeButtonStyle}"
                        Margin="10,0,0,0"/>
                <Button Content="⚙"
                        
                        Style="{DynamicResource ThemeSymbolButtonStyle}"
                        Margin="10,0,0,0"/>
                
                <Button Content="+"
                        FontSize="24"
                        Command="{Binding CreateCategoryCommand}"
                        Style="{DynamicResource ThemeSymbolButtonStyle}"
                        Margin="10,0,0,0"/>
            </StackPanel>

            <Border Grid.Row="1"
        Background="{DynamicResource WindowBackgroundBrush}"
        BorderBrush="{DynamicResource BorderBrush}"
        BorderThickness="1"
        CornerRadius="8"
        Padding="10">

                <Border.Resources>
                    <Style TargetType="Border" x:Key="ProgramTileStyle">
                        <Setter Property="Background" Value="{DynamicResource WindowBackgroundBrush}">

                        </Setter>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
                        <Setter Property="CornerRadius" Value="14"/>
                        <Setter Property="Padding" Value="12"/>
                        <Setter Property="Cursor" Value="Hand"/>
                        <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
                        <Setter Property="RenderTransform">
                            <Setter.Value>
                                <ScaleTransform ScaleX="1" ScaleY="1"/>
                            </Setter.Value>
                        </Setter>

                        <Style.Triggers>
                            <!-- Наведение -->
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.05" ScaleY="1.05"/>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#FF4A4A4A" Offset="0"/>
                                            <GradientStop Color="#FF3A3A3A" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Border.Resources>

                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding Programs}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal"
                               Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=ScrollContentPresenter}}"
                               MinWidth="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=ItemsControl}}"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>

                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Style="{StaticResource ProgramTileStyle}"
                            MouseLeftButtonDown="ProgramTile_MouseLeftButtonDown"
                            Width="220"
                            Height="120"
                            Margin="10">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Иконка -->
                                        <Image Grid.Column="0"
                                   Width="48" Height="48"
                                   Margin="0,0,12,0">
                                            <Image.Source>
                                                <Binding Path="Path" Converter="{StaticResource PathToIconConverter}"/>
                                            </Image.Source>
                                        </Image>

                                        <!-- Текст -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Name}"
                                           Foreground="{StaticResource TextForegroundBrush}"
                                           FontWeight="SemiBold"
                                           FontSize="14"
                                           TextTrimming="CharacterEllipsis"
                                           MaxWidth="140"/>
                                            <TextBlock Text="{Binding Category.Name}"
                                           Foreground="{StaticResource DisabledBrush}"
                                           FontSize="11"
                                           Margin="0,4,0,0"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>

        </Grid>
    </Grid>
</Window>
